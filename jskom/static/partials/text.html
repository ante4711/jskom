<div ng-controller="TextCtrl" ng-show="text">
  <h4 class="jskomNoWrap">
    <jskom:a text-no="{{ text.text_no }}">{{ text.text_no }}</jskom:a>
    / {{ text.creation_time }} / {{ text.author.pers_name }}
  </h4>
  
  <div>
    <div ng-repeat="ct in text.comment_to_list">
      <span class="jskomNoWrap">
        <span class="jskomCapitalize">{{ ct.type }}</span> to
        <jskom:a text-no="{{ ct.text_no }}">{{ ct.text_no }}</jskom:a>
        by {{ ct.author.pers_name }}
      </span>
    </div>
    
    <div ng-repeat="r in text.recipient_list">
      <span class="jskomCapitalize">{{ r.type }}:</span> {{ r.conf_name }}
    </div>
    
    <div>Subject: {{ text.subject }}</div>
    
    <div class="btn-group pull-right" data-toggle="buttons-radio" ng-show="text._type == 'text'">
      <button ng-click="textMode = 'default'" class="btn active">
        <i class="icon-align-left"></i>
      </button>
      <button ng-click="textMode = 'raw'" class="btn">
        <i class="icon-align-justify"></i>
      </button>
    </div>
    
    <div >
      <hr />
      <ng-switch on="text._type">
        <div ng-switch-default>
          [unknown content-type: &quot;{{ text.content_type }}&quot;]
        </div>
        <div ng-switch-when="image"><img ng-src="{{ text._image_url }}" /></div>
        <div ng-switch-when="text">
          <ng-switch on="textMode">
            <div ng-switch-when="default" jskom-bind-body="text.body"></div>
            <pre ng-switch-when="raw" jskom-bind-body="text.body"></pre>
            <!--<div ng-switch-when="html" ng-bind-html="text.body"></div>-->
          </ng-switch>
        </div>
      </ng-switch>
      
      <hr />
      
      <div ng-repeat="ci in text.comment_in_list">
        <span class="jskomNoWrap">
          <span class="jskomCapitalize">{{ ci.type }}</span> in
          <jskom:a text-no="{{ ci.text_no }}">{{ ci.text_no }}</jskom:a>
          <span ng-show="ci.author.pers_name">by {{ ci.author.pers_name }}</span>
        </span>
      </div>
    </div>

  </div>

  <div>
    <div class="form-actions">
      <button class="btn" ng-disabled="isCommentFormVisible"
              ng-click="isCommentFormVisible = true">
        Comment
      </button>
      
      <div class="pull-right">
        <div class="btn-group">
          <button class="btn dropdown-toggle" data-toggle="dropdown">
            Commands
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li>
              <a href="#" ng-click="showCommented()"
                 ng-hide="showCommented == null">Show commented</a>
            </li>
            <li>
              <a href="#" ng-click="showAllComments()"
                 ng-hide="showAllComments == null">Show all comments</a>
            </li>
            <li ng-hide="text._is_unread == false">
              <a href="#" ng-click="markAsRead()"
                 ng-disabled="readmarkIsLoading">Mark as read</a>
            </li>
            <li ng-hide="text._is_unread == true">
              <a href="#" ng-click="markAsUnread()"
                 ng-disabled="readmarkIsLoading">Mark as unread</a>
            </li>
          </ul>
        </div>
      </div>
      
      <div class="pull-right">
        <span class="label label-info" ng-show="text._is_unread == true">Unread</span>
        <span class="label label-success" ng-show="text._is_unread == false">Read</span>
        &nbsp;
      </div>
    </div>
    
    <jskom:new-comment comment-to="text" visible="isCommentFormVisible"></jskom:new-comment>
  </div>
</div>
